---
- name: Converge tool_installer role
  hosts: all
  vars:
    tool_installer_tools:
      - fzf
      - ripgrep
    tool_installer_shells:
      - bash
      - zsh
  roles:
    - role: eddiedunn.terminal.tool_installer

    - name: Install Python and requirements
      ansible.builtin.raw: |
        set -e
        apt-get update
        DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
          python3 python3-pip sudo bash curl
        ln -sf /usr/bin/python3 /usr/bin/python
      register: install_result
      changed_when: install_result.rc == 0
      ignore_errors: true
      retries: 3
      delay: 5
      until: install_result is succeeded

    - name: Ensure remote temporary directory exists
      ansible.builtin.file:
        path: /tmp/ansible
        state: directory
        mode: '1777'
        owner: root
        group: root

  tasks:
    - name: Gather facts after Python is installed
      ansible.builtin.setup:
      when: not ansible_facts

    - name: Include tool_installer role
      include_role:
        name: your_namespace.terminal.tool_installer
